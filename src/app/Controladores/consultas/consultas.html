<div class="consultas-container">
  <div class="header">
    <h1>üìä Consultas y Reportes ECO-MOVE</h1>
    <button class="btn-refresh" (click)="actualizar()">
      üîÑ Actualizar
    </button>
  </div>

  <!-- Consulta 1: Clientes con m√∫ltiples alquileres -->
  <div class="consulta-seccion">
    <h2>üë• 1. Clientes que alquilaron m√°s de un veh√≠culo</h2>
    <div class="alert alert-info" *ngIf="clientesMultiplesAlquileres.length === 0">
      No hay clientes con m√∫ltiples alquileres
    </div>
    <div class="tabla-responsive" *ngIf="clientesMultiplesAlquileres.length > 0">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>C√©dula</th>
            <th>Email</th>
            <th>Cantidad de Alquileres</th>
            <th>Tipo</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of clientesMultiplesAlquileres">
            <td>{{ item.cliente.nombreCompleto }}</td>
            <td>{{ item.cliente.cedula }}</td>
            <td>{{ item.cliente.email }}</td>
            <td class="numero-destacado">{{ item.cantidadAlquileres }}</td>
            <td>
              <span class="badge" [class.frecuente]="item.cliente.clienteFrecuente">
                {{ item.cliente.clienteFrecuente ? '‚≠ê Frecuente' : 'Regular' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Consulta 2: Veh√≠culos m√°s alquilados -->
  <div class="consulta-seccion">
    <h2>üèçÔ∏è 2. Veh√≠culos m√°s alquilados</h2>
    <div class="alert alert-info" *ngIf="vehiculosMasAlquilados.length === 0">
      No hay veh√≠culos alquilados
    </div>
    <div class="tabla-responsive" *ngIf="vehiculosMasAlquilados.length > 0">
      <table>
        <thead>
          <tr>
            <th>Marca</th>
            <th>Modelo</th>
            <th>A√±o</th>
            <th>Cilindrada</th>
            <th>Tarifa/D√≠a</th>
            <th>Veces Alquilado</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of vehiculosMasAlquilados; let i = index">
            <td>
              <span *ngIf="i === 0">ü•á</span>
              <span *ngIf="i === 1">ü•à</span>
              <span *ngIf="i === 2">ü•â</span>
              {{ item.moto.marca }}
            </td>
            <td>{{ item.moto.modelo }}</td>
            <td>{{ item.moto.anio }}</td>
            <td>{{ item.moto.cilindrada }} cc</td>
            <td>${{ item.moto.precioAlquilerDia }}</td>
            <td class="numero-destacado">{{ item.cantidadAlquileres }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Consulta 3: Alquileres con descuentos -->
  <div class="consulta-seccion">
    <h2>üí∞ 3. Alquileres con descuento de cliente frecuente y uso extendido</h2>
    <div class="alert alert-info" *ngIf="alquileresConDescuentos.length === 0">
      No hay alquileres con ambos descuentos
    </div>
    <div class="tabla-responsive" *ngIf="alquileresConDescuentos.length > 0">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Veh√≠culo</th>
            <th>D√≠as</th>
            <th>Importe</th>
            <th>Desc. Uso Ext. (15%)</th>
            <th>Desc. Frecuente (10%)</th>
            <th>Total Descuentos</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let alquiler of alquileresConDescuentos">
            <td>{{ getNombreCliente(alquiler.clienteId) }}</td>
            <td>{{ getNombreMoto(alquiler.motoId) }}</td>
            <td>{{ alquiler.diasAlquiler }}</td>
            <td>${{ alquiler.importe.toFixed(2) }}</td>
            <td class="descuento">${{ alquiler.descuentoUsoExtendido.toFixed(2) }}</td>
            <td class="descuento">${{ alquiler.descuentoClienteFrecuente.toFixed(2) }}</td>
            <td class="total-descuentos">
              ${{ (alquiler.descuentoUsoExtendido + alquiler.descuentoClienteFrecuente).toFixed(2) }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Consulta 4: Total recaudado -->
  <div class="consulta-seccion destacada">
    <h2>üíµ 4. Total recaudado por ECO-MOVE</h2>
    <div class="recaudacion-grid">
      <div class="recaudacion-card">
        <div class="icono">üìà</div>
        <div class="valor">${{ totalRecaudado.importeNeto.toFixed(2) }}</div>
        <div class="etiqueta">Importe Neto</div>
        <div class="descripcion">Ingresos por alquileres (sin descuentos)</div>
      </div>
      <div class="recaudacion-card">
        <div class="icono">üè¶</div>
        <div class="valor">${{ totalRecaudado.depositos.toFixed(2) }}</div>
        <div class="etiqueta">Dep√≥sitos</div>
        <div class="descripcion">Dep√≥sitos recibidos (12%)</div>
      </div>
      <div class="recaudacion-card">
        <div class="icono">‚ö†Ô∏è</div>
        <div class="valor">${{ totalRecaudado.multas.toFixed(2) }}</div>
        <div class="etiqueta">Multas</div>
        <div class="descripcion">Penalizaciones por retrasos</div>
      </div>
      <div class="recaudacion-card total">
        <div class="icono">üí∞</div>
        <div class="valor">${{ totalRecaudado.total.toFixed(2) }}</div>
        <div class="etiqueta">TOTAL RECAUDADO</div>
        <div class="descripcion">Suma de todos los ingresos</div>
      </div>
    </div>
  </div>

  <!-- Consulta 5: Clientes con multa mayor al dep√≥sito -->
  <div class="consulta-seccion">
    <h2>‚ö†Ô∏è 5. Clientes que devolvieron tarde y pagaron multa mayor al dep√≥sito</h2>
    <div class="alert alert-success" *ngIf="clientesMultaMayorDeposito.length === 0">
      ‚úÖ No hay clientes con multas superiores al dep√≥sito
    </div>
    <div class="tabla-responsive" *ngIf="clientesMultaMayorDeposito.length > 0">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Veh√≠culo</th>
            <th>D√≠as de Retraso</th>
            <th>Dep√≥sito</th>
            <th>Multa</th>
            <th>Total a Pagar</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of clientesMultaMayorDeposito" class="fila-alerta">
            <td>{{ item.cliente.nombreCompleto }}</td>
            <td>{{ getNombreMoto(item.alquiler.motoId) }}</td>
            <td class="retraso">{{ item.devolucion.diasRetraso }} d√≠as</td>
            <td>${{ item.alquiler.deposito.toFixed(2) }}</td>
            <td class="multa">${{ item.devolucion.multaPorRetraso.toFixed(2) }}</td>
            <td class="total-pagar">${{ item.devolucion.totalAPagar.toFixed(2) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
